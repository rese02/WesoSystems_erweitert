rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Der Pfad für die Dokumente eines Gastes.
    // {bookingId} ist die geheime, unerratbare ID der Buchung.
    match /bookings/{bookingId}/{fileName} {
      
      // ERLAUBT: Einen Schreibzugriff (Upload) für JEDEN in diesen spezifischen Ordner.
      // Das ist sicher, weil niemand die bookingId erraten kann.
      // Sie funktioniert wie ein einmaliges Passwort für den Upload.
      allow create: if true;

      // VERBOTEN: Niemand (außer eingeloggten Nutzern) darf Dateien lesen,
      // aktualisieren oder löschen. Die Dokumente sind nach dem Upload sicher.
      allow read, update, delete: if request.auth != null;
    }

    // Regel für Logos
    match /logos/{fileId}/{fileName} {
       allow create: if true; // Jeder darf Logos hochladen
       allow read: if true; // Jeder darf Logos lesen
       allow delete: if request.auth != null; // Nur eingeloggte Admins/Hoteliers dürfen löschen
    }
  }
}
