rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // The path for a guest's documents.
    // {bookingId} is the secret, unguessable ID of the booking.
    // Allow create (upload) for ANYONE to this specific folder.
    // This is safe because nobody can guess the bookingId.
    // It acts like a one-time password for the upload.
    match /bookings/{bookingId}/{fileName} {
      allow create: if true;

      // Disallow anyone other than authenticated users from reading,
      // updating, or deleting files. Documents are secure after upload.
      allow read, update, delete: if request.auth != null;
    }

    // Allow logo uploads for anyone, as they are public branding assets.
    // The path is also unguessable.
     match /bookings/new-hotel-logo/{fileName} {
      allow create: if true;
      allow read, update, delete: if request.auth != null;
    }

     match /bookings/{hotelId}/{fileName} {
      allow create: if true; // Allows hotelier to upload new logo
      allow read: if true; // Allow public read for logos
      allow update, delete: if request.auth != null;
    }
  }
}
